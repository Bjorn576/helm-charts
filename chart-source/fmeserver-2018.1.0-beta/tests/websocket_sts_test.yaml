suite: websocket statefulset
templates:
  - websocket-statefulset.yaml
tests:
  - it: renders default values
    set:
      fmeserver.buildNr: '18888'
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: "safe-harbor.safe.internal/fmeserver-kubernetes/fmeserver-core:18888"
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: Always
      - equal:
          path: spec.template.spec.volumes[0].persistentVolumeClaim.claimName
          value: fmeserver-data-18888

  - it: renders labels
    set:
      fmeserver.buildNr: '18888'
    asserts:
      - equal:
          path: metadata.labels.safe\.k8s\.fmeserver\.component
          value: websocket
      - equal:
          path: metadata.labels.safe\.k8s\.fmeserver\.build
          value: '18888'

  - it: allows to change the pull policy, registry and namespace
    set:
      fmeserver.buildNr: '18888'
      images.pullPolicy: IfNotPresent
      images.registry: quay.iu
      images.namespace: safesoftwure
    asserts:
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: IfNotPresent
      - equal:
          path: spec.template.spec.containers[0].image
          value: "quay.iu/safesoftwure/fmeserver-core:18888"
